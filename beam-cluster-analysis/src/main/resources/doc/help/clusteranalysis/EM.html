<html>
<head>
    <title>Expectation Maximization (EM) Cluster Analysis Tool</title>
    <link rel="stylesheet" href="../style.css">
</head>

<body>

<table class="header">
    <tr class="header">
        <td class="header">&nbsp;
            Expectation Maximization (EM) Cluster Analysis
        </td>
        <td class="header" align="right"><a href="../general/BeamOverview.html"><img src="../images/BeamHeader.jpg"
                                                                                     border=0></a>
        </td>
    </tr>
</table>

<h3>Introduction</h3>

<p>
    <strong>Cluster analysis</strong> (or <strong>clustering</strong>) is the classification of objects into different
    groups, or more precisely, the partitioning of a data set into subsets (<strong>clusters</strong> or
    <strong>classes</strong>), so that the data in each subset
    (ideally) share some common trait - often proximity according to some defined distance measure. Data clustering is a
    common
    technique for statistical data analysis, which is used in many fields, including machine learning, data mining,
    pattern recognition, image analysis and bioinformatics. The computational task of classifying the data set into
    <em>k</em> clusters is often referred to as <em>k</em>-clustering.
</p>

<h3>Algorithm</h3>

<p>
    The EM algorithm implemented in BEAM can be regarded as a generalization of
    the <a href="KMeans.html">k-means algorithm</a>. The main differences are:
</p>

<ol>
    <li>
        Pixels are not assigned to clusters. The membership of each pixel to a cluster is defined by a (posterior)
        probability. For each pixel, there are as many (posterior) probability values as there are clusters and
        for each pixel the sum of (posterior) probability values is equal to unity.
    </li>
    <li>
        Clusters are defined by a prior probability, a center, and a covariance matrix. Cluster centers and covariance
        matrixes define a Mahalanobis distance between a cluster center and a pixel.
    </li>
    <li>
        For each cluster a pixel likelihood function is defined as a normalized Gaussian function of the Mahalanobis
        distance between cluster center and pixels.
    </li>
    <li>
        Posterior cluster probabilities as well as cluster centers and covariance matrixes and are recalculated
        iteratively. In the <em>E-step</em>, for each cluster, the cluster prior and posterior probabilities are
        recalculated. In the <em>M-step</em> all cluster centers and covariance matrixes are recalculated from the
        updated posteriors, so that the resulting data likelihood function is maximized.
    </li>
    <li>
        When the iteration is completed, each pixel is assigned to the cluster where the posterior probability is
        maximal.
    </li>
</ol>

<p>
    The algorithm is described in detail on the Wikipedia entry on
    <a href="http://en.wikipedia.org/wiki/Expectation-maximization_algorithms">Expectation maximization</a>
</p>

<p>
    The result of the cluster analysis is written to a band named <strong>class_indices</strong>. The
    values in this band indicate the class indices, where a value '0' refers to the first
    cluster, a value of '1' refers to the second cluster, etc. The class indices are sorted according
    to the number of members in the corresponding cluster, i.e. a class index of '0' refers to the
    cluster with the most members.
</p>

<p>
    Note that an index coding is attached to the <strong>class_indices</strong> band, which can be edited
    in the <a href="visat/ColorManipulationWindow.html#editingIndexCodedBands">Color Manipulation Window</a>.
    It is possible to change the label and the color associated with a class index. The last columns of the
    color manipulation window lists the location of the cluster centers. Further information on the clusters
    can be found in the product metadata.
</p>

<p>
    <img src="images/em-color-manip.png" alt="Color Manipulation Window"/>
</p>

<p>
    The <em>Collocation Tool</em> allows to collocate two spatially
    overlapping products. Collocating two products implies that the pixel
    values of one product (the <em>slave</em>) are resampled into the geographical
    raster of the other (the <em>master</em>).
</p>

<p>
    In order to avoid naming conflicts, the Collocation Tool allows to rename both
    master and slave components such as bands, flag codings and bitmask definitions
    according to a user defined pattern.
</p>

<h3>Algorithm</h3>

<p>
    When two products are collocated, a new product is created which contains a
    copy of all components of the master product, i.e. band data, tie-point grids,
    flag codings, bitmask definitions, and metadata. The components of the slave
    product are transfered in a different manner:
</p>

<p>
    The band data of the slave product are resampled into the geographical
    raster of the master product. The user may choose between three different
    resampling methods: <a href="../general/ResamplingMethods.html">Nearest
    Neighbour</a>, <a href="../general/ResamplingMethods.html">Bilinear
    Interpolation</a>, and <a href="../general/ResamplingMethods.html">Cubic
    Convolution</a>. For flag bands and bands where a valid-pixel expression
    is defined, the Nearest Neighbour method is used.
    In order to establish a mapping between the samples in the master and the
    slave rasters, the geographical position of a master sample is used to find
    the corresponding sample in the slave raster. If there is no sample for a
    requested geographical position, the master sample is set to the no-data
    value which was defined for the slave band. The collocation algorithm
    requires accurate geopositioning information for both master and slave
    products. When necessary, accurate geopositioning information may be provided
    by <a href="../visat/GcpManagement.html">ground control points</a>.
</p>

<p>
    As for the master product, the tie-point grids, flag codings and bitmask
    definitions of the slave product are copied. Slave product metadata are not
    transfered.
</p>

<h3>User Interfaces</h3>

<p>
    The Collocation Tool can be invoked from the VISAT tool menu by selecting
    the <b>Collocation</b> command, or in batch mode by using the command line
    tool <i><code>gpt</code></i> (Graph Processing Tool) which is located
    in the BEAM <code>bin</code> directory. For the latter type
    <code>gpt Collocate -h</code> for further information.
</p>

<p>
    Selecting the <b>Collocation</b> command from the VISAT tool menu pops up the
    following dialog:
</p>

<p align="center">
    <img src="images/CollocationDialog.png" alt="Collocation Dialog"/>
</p>

<h5>Source Products Group</h5>

<p class="i1">
    <b>Master:</b>
    Here the user specifies the master product. The combo box presents
    a list of all products open in VISAT. The user may select one of these
    or, by clicking on the button next to the combo box, choose a product
    from the file system.
</p>

<p class="i1">
    <b>Slave:</b>
    Here the user specifies the slave product. The combo box presents
    a list of all products open in VISAT. The user may select one of these
    or, by clicking on the button next to the combo box, choose a product
    from the file system.
</p>

<h5>Target Product Group</h5>

<p class="i1">
    <b>Name:</b>
    Used to specify the name of the target product.
</p>

<p class="i1">
    <b>Save to:</b>
    Used to specify whether the target product should be saved to the file system. The
    combo box presents a list of file formats, currently
    BEAM-DIMAP, GeoTIFF, and HDF5.
</p>

<p class="i1">
    <b>Open in VISAT:</b>
    Used to specify whether the target product should be opened in VISAT. When the
    the target product is not saved, it is opened in VISAT automatically.
</p>

<h5>Component Renaming Group</h5>

<p class="i1">
    Each product consists of different components, such as bands, flag codings and
    bitmask definitions. In order to avoid naming conflicts between master and slave
    product components, the user can specify a renaming pattern.
</p>

<p class="i1">
    <b>Rename master components:</b>
    By checking or unchecking this option the automatic renaming of master product
    components can be activated or deactivated, respectively. If activated, all
    components of the master product are renamed according to the
    pattern given in the text field next to the check box. The expression
    <code>${ORIGINAL_NAME}</code> can be used to refer to the original name of the
    component.
</p>

<p class="i1">
    <b>Rename slave components:</b>
    By checking or unchecking this option the automatic renaming of slave product
    components can be activated or deactivated, respectively. If activated, all
    components of the slave product are renamed according to the
    pattern given in the text field next to the check box. The expression
    <code>${ORIGINAL_NAME}</code> can be used to refer to the original name of the
    component.
</p>

<h5>Resampling Group</h5>

<p class="i1">
    <b>Method:</b>
    The combo box presents several resampling methods:
    <a href="../general/ResamplingMethods.html">Nearest
        Neighbour</a>, <a href="../general/ResamplingMethods.html">Bilinear
    Interpolation</a>, and <a href="../general/ResamplingMethods.html">Cubic
    Convolution</a>. When the slave product contains a band where a valid-pixel
    expression is defined, only the <a href="../general/ResamplingMethods.html">Nearest
    Neighbour</a> method is presented.
</p>

<br>
<hr>
</body>
</html>
